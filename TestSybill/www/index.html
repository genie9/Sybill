<!DOCTYPE html>
<html lang="fi">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <title>Horoskoopit</title>

        <link href='https://fonts.googleapis.com/css?family=Philosopher:400,700' rel='stylesheet' type='text/css'>
        <link href='https://fonts.googleapis.com/css?family=Fira+Sans:500' rel='stylesheet' type='text/css'>
        <link href="css/bootstrap.min.css" rel="stylesheet">
        <link href="css/rajatieto.css" rel="stylesheet">
        <link href="css/rth.css" rel="stylesheet">
        <!--[if IE 7]><link rel="stylesheet" href="css/rth-ie7.css"><![endif]-->

    </head>
    <body>
        <section class="container-fluid">
            <div class="row">
                <div class="col-xs-12">

                    <div class="page-header">
                        <a href="http://www.rajatieto.org" title="Rajatieto.org"><img src="images/rajatieto-logo.png" class="img-responsive img-rounded pull-right img-logo" alt="palvelun tarjoaa Rajatieto.org"></a>
                        <h1><img src="images/oinas-01.png" id="image" class="img-responsive img-rounded pull-left img-horoscope-head" data-toggle="collapse" data-target="#collapseAllHoroscopes" aria-expanded="false" aria-controls="collapseAllHoroscopes" alt="Oinas"><span id="signName">Oinas </span><small id="small">21.3. - 19.4.</small></h1>
                    </div>
                </div>
            </div>
        </section>


        <section class="container">
            <div class="row">
                <div class="col-xs-12">

                    <!--<p class="text-center">
                    <button class="btn btn-default btn-sm btn-all-horoscopes" type="button" data-toggle="collapse" data-target="#collapseAllHoroscopes" aria-expanded="false" aria-controls="collapseAllHoroscopes"><i class="icon-th"></i> Kaikki horoskooppimerkit</button>
                    </p>-->

                    <div class="collapse" id="collapseAllHoroscopes">
                        <aside>
                            <h2>Valitse horoskooppi</h2>
                            <div class="row">
                                <div class="col-xs-6 col-sm-4 col-md-3">
                                    <div class="panel panel-default panel-horoscope horoscope" onclick="showHoroscope('Oinas')">
                                        <div class="panel-heading"><h2 class="panel-title">Oinas <span class="text-muted visible-xs-block visible-sm-inline visible-md-inline visible-lg-inline">21.3. - 19.4.</span></h2></div>
                                        <div class="panel-body">
                                            <img src="images/oinas-01.png" class="img-responsive" alt="Oinas">
                                        </div>
                                    </div>
                                </div>

                                <div class="col-xs-6 col-sm-4 col-md-3">
                                    <div class="panel panel-default panel-horoscope horoscope" onclick="showHoroscope('Harka')">
                                        <div class="panel-heading"><h2 class="panel-title">Härkä <span class="text-muted visible-xs-block visible-sm-inline visible-md-inline visible-lg-inline">20.4. - 20.5.</span></h2></div>
                                        <div class="panel-body">
                                            <img src="images/harka-01.png" class="img-responsive" alt="Härkä">
                                        </div>
                                    </div>
                                </div>

                                <div class="clearfix visible-xs"></div>

                                <div class="col-xs-6 col-sm-4 col-md-3">
                                    <div class="panel panel-default panel-horoscope horoscope" onclick="showHoroscope('Kaksoset')">
                                        <div class="panel-heading"><h2 class="panel-title">Kaksoset <span class="text-muted visible-xs-block visible-sm-inline visible-md-inline visible-lg-inline">21.5. - 20.6.</span></h2></div>
                                        <div class="panel-body">
                                            <img src="images/kaksoset-01.png" class="img-responsive" alt="Kaksoset">
                                        </div>
                                    </div>
                                </div>

                                <div class="col-xs-6 col-sm-4 col-md-3">
                                    <div class="panel panel-default panel-horoscope horoscope" onclick="showHoroscope('Rapu')">
                                        <div class="panel-heading"><h2 class="panel-title">Rapu <span class="text-muted visible-xs-block visible-sm-inline visible-md-inline visible-lg-inline">21.6. - 22.7.</span></h2></div>
                                        <div class="panel-body">
                                            <img src="images/rapu-01.png" class="img-responsive" alt="Rapu">
                                        </div>
                                    </div>
                                </div>

                                <div class="clearfix visible-xs"></div>

                                <div class="col-xs-6 col-sm-4 col-md-3">
                                    <div class="panel panel-default panel-horoscope horoscope" onclick="showHoroscope('Leijona')">
                                        <div class="panel-heading"><h2 class="panel-title">Leijona <span class="text-muted visible-xs-block visible-sm-inline visible-md-inline visible-lg-inline">23.7. - 22.8.</span></h2></div>
                                        <div class="panel-body">
                                            <img src="images/leijona-01.png" class="img-responsive" alt="Leijona">
                                        </div>
                                    </div>
                                </div>

                                <div class="col-xs-6 col-sm-4 col-md-3">
                                    <div class="panel panel-default panel-horoscope horoscope" onclick="showHoroscope('Neitsyt')">
                                        <div class="panel-heading"><h2 class="panel-title">Neitsyt <span class="text-muted visible-xs-block visible-sm-inline visible-md-inline visible-lg-inline">23.8. - 22.9.</span></h2></div>
                                        <div class="panel-body">
                                            <img src="images/neitsyt-01.png" class="img-responsive" alt="Neitsyt">
                                        </div>
                                    </div>
                                </div>

                                <div class="clearfix visible-xs"></div>

                                <div class="col-xs-6 col-sm-4 col-md-3">
                                    <div class="panel panel-default panel-horoscope horoscope" onclick="showHoroscope('Vaaka')">
                                        <div class="panel-heading"><h2 class="panel-title">Vaaka <span class="text-muted visible-xs-block visible-sm-inline visible-md-inline visible-lg-inline">23.9. - 23.10.</span></h2></div>
                                        <div class="panel-body">
                                            <img src="images/vaaka-01.png" class="img-responsive" alt="Vaaka">
                                        </div>
                                    </div>
                                </div>

                                <div class="col-xs-6 col-sm-4 col-md-3">
                                    <div class="panel panel-default panel-horoscope horoscope" onclick="showHoroscope('Skorpioni')">
                                        <div class="panel-heading"><h2 class="panel-title">Skorpioni <span class="text-muted visible-xs-block visible-sm-inline visible-md-inline visible-lg-inline">24.10. - 22.11.</span></h2></div>
                                        <div class="panel-body">
                                            <img src="images/skorpioni-01.png" class="img-responsive" alt="Skorpioni">
                                        </div>
                                    </div>
                                </div>

                                <div class="clearfix visible-xs"></div>

                                <div class="col-xs-6 col-sm-4 col-md-3">
                                    <div class="panel panel-default panel-horoscope horoscope" onclick="showHoroscope('Jousimies')">
                                        <div class="panel-heading"><h2 class="panel-title">Jousimies <span class="text-muted visible-xs-block visible-sm-inline visible-md-inline visible-lg-inline">23.11. - 21.12.</span></h2></div>
                                        <div class="panel-body">
                                            <img src="images/jousimies-01.png" class="img-responsive" alt="Jousimies">
                                        </div>
                                    </div>
                                </div>

                                <div class="col-xs-6 col-sm-4 col-md-3">
                                    <div class="panel panel-default panel-horoscope horoscope" onclick="showHoroscope('Kauris')">
                                        <div class="panel-heading"><h2 class="panel-title">Kauris <span class="text-muted visible-xs-block visible-sm-inline visible-md-inline visible-lg-inline">22.12. - 19.1.</span></h2></div>
                                        <div class="panel-body">
                                            <img src="images/kauris-01.png" class="img-responsive" alt="Kauris">
                                        </div>
                                    </div>
                                </div>

                                <div class="clearfix visible-xs"></div>

                                <div class="col-xs-6 col-sm-4 col-md-3">
                                    <div class="panel panel-default panel-horoscope horoscope" onclick="showHoroscope('Vesimies')">
                                        <div class="panel-heading"><h2 class="panel-title">Vesimies <span class="text-muted visible-xs-block visible-sm-inline visible-md-inline visible-lg-inline">20.1. - 19.2.</span></h2></div>
                                        <div class="panel-body">
                                            <img src="images/vesimies-01.png" class="img-responsive" alt="Vesimies">
                                        </div>
                                    </div>
                                </div>

                                <div class="col-xs-6 col-sm-4 col-md-3">
                                    <div class="panel panel-default panel-horoscope horoscope" onclick="showHoroscope('Kalat')">
                                        <div class="panel-heading"><h2 class="panel-title">Kalat <span class="text-muted visible-xs-block visible-sm-inline visible-md-inline visible-lg-inline">20.2. - 20.3.</span></h2></div>
                                        <div class="panel-body">
                                            <img src="images/kalat-01.png" class="img-responsive" alt="Kalat">
                                        </div>
                                    </div>
                                </div>
                            </div>

                        </aside>
                    </div>
                    <!-- End of collapse -->

                </div>
            </div>
        </section>
        <section class="container-fluid main-content">
            <div class="row">
                <div class="col-xs-12">
                    <ul class="nav nav-tabs" role="tablist">
                        <li role="presentation" class="active"><a href="#viikko" aria-controls="viikkohoroskooppi" role="tab" data-toggle="tab">Viikko<span class="hidden-xs">horoskooppi</span></a></li>
                        <li role="presentation"><a href="#kuukausi" aria-controls="kuukausihoroskooppi" role="tab" data-toggle="tab">Kuukausi<span class="hidden-xs">horoskooppi</span></a></li>
                        <li role="presentation"><a href="#vuosi" aria-controls="vuosihoroskooppi" role="tab" data-toggle="tab">Vuosi<span class="hidden-xs">horoskooppi</span></a></li>
                    </ul>
                    <div class="tab-content">
                        <div role="tabpanel" class="tab-pane fade in active" id="viikko">
                            <h2 class="horoscope-heading" id="vk_info"><span class="text-muted">Viikkohoroskooppi</span><br>Viikko 50, 7.12.2015 – 13.12.2015</h2>
                            <p class="htext" id="vk_horoscope"><img src="images/ikoni_viikkohoroskooppi-01.png" class="img-responsive pull-left img-horoscope-type" alt="Viikkohoroskooppi"></p>
                        </div>
                        <div role="tabpanel" class="tab-pane fade" id="kuukausi">
                            <h2 class="horoscope-heading" id="kk_info"><span class="text-muted">Kuukausihoroskooppi</span><br>Tammikuu</h2>
                            <p class="htext" id="kk_horoscope"><img src="images/ikoni_kkhoroskooppi-01.png" class="img-responsive pull-left img-horoscope-type" alt="Kuukausihoroskooppi"></p>
                        </div>
                        <div role="tabpanel" class="tab-pane fade" id="vuosi">
                            <h2 class="horoscope-heading" id="v_info"><span class="text-muted">Vuosihoroskooppi</span><br>2015</h2>
                            <p class="htext" id="v_horoscope"><img src="images/ikoni_vuosihoroskooppi-01.png" class="img-responsive pull-left img-horoscope-type" alt="Vuosihoroskooppi"></p>
                        </div>
                    </div>
                    <hr>
                    <p class="text-center"><a href="#" class="btn btn-default" onclick="selectSign()"><i class="icon-star-empty"></i> Tallenna omaksi merkiksi</a></p>


                </div>
            </div>
        </section>

        <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.3/jquery.min.js"></script>
        <script src="scripts/bootstrap.min.js"></script>
        <script src="scripts/index.js"></script>
        <script>
                        //window.localStorage.removeItem('UserSign')
                        var applaunchCount = window.localStorage.getItem('launchCount');
                        var mySign = JSON.parse(window.localStorage.getItem('UserSign'));
                        var curSign = "";
                        var weekArray = "";
                        var monthArray = "";
                        var yearArray = "";
                        var urlweek = "http://api.rajatieto.org/v1/horoscopes/week";
                        var urlmonth = "http://api.rajatieto.org/v1/horoscopes/month";
                        var urlyear = "http://api.rajatieto.org/v1/horoscopes/year";
                        var xmlhttpWeek = "";
                        var xmlhttpMonth = "";
                        var xmlhttpYear = "";

                        //check
                        console.log("1. applaunchCount = " + applaunchCount + " ja mySign = " + mySign);

                        //Check if launched before
                        if (!applaunchCount || !mySign || mySign.name == '') {     //NOT
                            //Local storage is not set, hence first time launch. set the local storage item
                            window.localStorage.setItem('launchCount', 1);
                            window.localStorage.setItem('UserSign', JSON.stringify({set: 0, name: ''}));

                            //check
                            console.log("NEW. applaunchCount = " + applaunchCount + " ja mySign = " + mySign);

                            $('#collapseAllHoroscopes').collapse('show');

                        } else {
                            //getHoroscope(xmlhttpWeek, weekArray, urlweek)

                            xmlhttpWeek = new XMLHttpRequest();

                            if (!xmlhttpWeek) {
                                alert('Giving up :( Cannot create an XMLHTTP instance');
                                //getHoroscope();
                            }

                            ////check
                            //alert('1. ' + xmlhttpWeek.readyState);

                            xmlhttpWeek.onreadystatechange = function () {
                                if (xmlhttpWeek.readyState === 4) {
                                    if (xmlhttpWeek.status === 200) {

                                        ////check
                                        //alert('2. ' + xmlhttpWeek.readyState);

                                        weekArray = JSON.parse(xmlhttpWeek.responseText);

                                        ////check
                                        //console.log('weekarray ' + weekArray)

                                        // Start of month call //// Start of year call //
                                        xmlhttpMonth = new XMLHttpRequest();

                                        ////check
                                        //alert('1. ' + xmlhttpMonth.readyState);

                                        xmlhttpMonth.onreadystatechange = function () {
                                            if (xmlhttpMonth.readyState === 4) {
                                                if (xmlhttpMonth.status === 200) {

                                                    ////check
                                                    //alert('2. ' + xmlhttpMonth.readyState);

                                                    monthArray = JSON.parse(xmlhttpMonth.responseText);

                                                    ////check
                                                    //console.log('montharray ' + monthArray)

                                                    // Start of year call //
                                                    xmlhttpYear = new XMLHttpRequest()

                                                    ////check
                                                    //alert('1. ' + xmlhttpYear.readyState);

                                                    xmlhttpYear.onreadystatechange = function () {
                                                        if (xmlhttpYear.readyState === 4) {
                                                            if (xmlhttpYear.status === 200) {

                                                                ////check
                                                                //alert('2. ' + xmlhttpYear.readyState);

                                                                yearArray = JSON.parse(xmlhttpYear.responseText);

                                                                ////check
                                                                //console.log('yeararray ' + yearArray)

                                                                showHoroscope(mySign.name);
                                                            } else {
                                                                alert('There was a problem with the request.');
                                                            }
                                                        }
                                                    };
                                                    ////check
                                                    //alert('3. ' + xmlhttpYear.readyState);

                                                    xmlhttpYear.open("GET", urlyear, true);
                                                    xmlhttpYear.send();
                                                    // End of year call //

                                                } else {
                                                    alert('There was a problem with the request.');
                                                }
                                            }
                                        };
                                        ////check
                                        //alert('3. ' + xmlhttpWeek.readyState);

                                        xmlhttpMonth.open("GET", urlmonth, true);
                                        xmlhttpMonth.send();
                                        // End of month call //


                                    } else {
                                        alert('There was a problem with the request.');
                                    }
                                }
                            };
                            ////check
                            //alert('3. ' + xmlhttpWeek.readyState);

                            xmlhttpWeek.open("GET", urlweek, true);
                            xmlhttpWeek.send();

                        }

                        function getHoroscope(xmlhttp, array, url) {
                            // check
                            console.log("gethoro: url = " + url);
                            xmlhttp = new XMLHttpRequest();
                            if (!xmlhttp) {
                                alert('Giving up :( Cannot create an XMLHTTP instance');
                                //getHoroscope(xmlhttp, array, url);
                            }

                            //check
                            alert('1. ' + xmlhttp.readyState);
                            xmlhttp.onreadystatechange =
                                    //alertContents(xmlhttp, array)

                                            function () {
                                                if (xmlhttp.readyState === 4 && xmlhttp.status === 200) {
                                                    //check
                                                    alert('2. ' + xmlhttp.readyState);
                                                    array = JSON.parse(xmlhttp.responseText);

                                                    //check
                                                    console.log(' array ' + array);
                                                }
                                            };
                                    //check
                                    alert('3. ' + xmlhttp.readyState);
                                    xmlhttp.open("GET", url, true);
                                    xmlhttp.send();

                                    // showHoroscope(sign)
                                }

                        function alertContents(xmlhttp, array) {
                            if (xmlhttp.readyState === XMLHttpRequest.DONE) {
                                if (xmlhttp.status === 200) {
                                    //check
                                    alert('2. ' + xmlhttp.readyState);
                                    array = JSON.parse(xmlhttp.responseText);

                                    console.log(' 2.sign ' + sign + array);
                                } else {
                                    alert('There was a problem with the request.');
                                }
                            }
                        }

                        function showHoroscope(sign) {
                            curSign = sign;
                            console.log('showhoro: sign ' + sign + weekArray);

                            var image = document.getElementById('image');
                            image.src = "images/" + sign.toLowerCase() + "-01.png";

                            var out = "";
                            for (i = 0; i < weekArray.length; i++) {
                                if (weekArray[i].sign == sign) {
                                    console.log('arrSign week ' + weekArray[i].fiSign);
                                    document.getElementById("signName").innerHTML = weekArray[i].fiSign;
                                    document.getElementById("small").innerHTML = " " + weekArray[i].horoscopeDays;
                                    document.getElementById("vk_horoscope").innerHTML = weekArray[i].fortune;
                                    out += "Viikko " + weekArray[i].week + " " + weekArray[i].weekString;
                                    console.log(out);
                                    document.getElementById("vk_info").innerHTML = out;

                                }
                            }
                            for (i = 0; i < monthArray.length; i++) {
                                if (monthArray[i].sign == sign) {
                                    console.log('arrSign month' + monthArray[i].fiSign);
                                    document.getElementById("kk_horoscope").innerHTML = monthArray[i].fortune;
                                    document.getElementById("kk_info").innerHTML = monthArray[i].period;
                                }
                            }
                            for (i = 0; i < yearArray.length; i++) {
                                if (yearArray[i].sign == sign) {
                                    console.log('arrSign year' + yearArray[i].fiSign);
                                    document.getElementById("v_horoscope").innerHTML = yearArray[i].fortune;
                                    document.getElementById("v_info").innerHTML = yearArray[i].period;
                                }
                            }

                            $('#collapseAllHoroscopes').collapse('hide');
                        }

                        // set global UserSign
                        function selectSign() {
                            var uSign = JSON.parse(window.localStorage.getItem('UserSign'));

                            // CHECK
                            console.log('curSign ' + curSign);

                            if (uSign.set === 0) {
                                uSign.set = 1;
                            }
                            uSign.name = curSign;

                            // CHECK
                            console.log(JSON.stringify(uSign));

                            window.localStorage.setItem('UserSign', JSON.stringify(uSign));

                            // CHECK
                            console.log('UserSign' + window.localStorage.getItem('UserSign'));
                            console.log('uSign ' + uSign);
                        }

        </script>
    </body>
</html>
